spring.application.name=student-pantry-backend

# Configuration de la base de données MySQL
spring.datasource.url=jdbc:mysql://localhost:3306/student-pantry-db?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Configuration JPA/Hibernate
spring.jpa.hibernate.ddl-auto=create
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect

# Initialisation des données de test (important pour les utilisateurs de test)
spring.jpa.defer-datasource-initialization=true
spring.sql.init.mode=always

# Pour afficher les requêtes SQL générées
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Logs supplémentaires pour débugger CORS et Web
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.fr.cop1.studentpantrybackend=DEBUG
logging.level.org.springframework.web.cors=TRACE

# Configuration du serveur
server.port=8080
# Ne pas utiliser context-path pour éviter les problèmes de routage
#server.servlet.context-path=/api

# Configuration CORS (backup au niveau Spring Boot)
spring.web.cors.allowed-origins=http://localhost:4200
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true
spring.web.cors.max-age=3600

# Configuration pour éviter les erreurs de démarrage
spring.main.allow-bean-definition-overriding=true

# Configuration HTTP/Tomcat pour améliorer la compatibilité CORS
server.tomcat.relaxed-query-chars=|,{,},[,]
server.tomcat.relaxed-path-chars=|,{,},[,]

# Configuration d'encodage
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# Configuration de la sécurité pour le développement
spring.security.user.name=admin
spring.security.user.password=admin
spring.security.user.roles=ADMIN

# Désactiver la sécurité par défaut pour les tests (à réactiver en production)
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration

# Sécurité JWT (décommentez quand vous implémentez JWT)
#jwt.secret=votre_clé_secrète_très_longue_et_complexe_à_remplacer_en_production
#jwt.expiration=86400000  # 24 heures en millisecondes

# Configuration des emails (à configurer avec vos paramètres SMTP)
#spring.mail.host=smtp.example.com
#spring.mail.port=587
#spring.mail.username=username
#spring.mail.password=password
#spring.mail.properties.mail.smtp.auth=true
#spring.mail.properties.mail.smtp.starttls.enable=true

# Taille maximale des fichiers uploadés (pour les pièces jointes comme carte étudiante)
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Configuration de la session
#spring.session.store-type=jdbc
#spring.session.jdbc.initialize-schema=always

# Configuration pour améliorer les performances en développement
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Configuration pour débugger les problèmes de connexion DB
logging.level.com.zaxxer.hikari.HikariConfig=DEBUG
logging.level.com.zaxxer.hikari=TRACE

# Affichage des beans Spring au démarrage (utile pour débugger)
# logging.level.org.springframework.beans.factory=DEBUG

# Configuration pour éviter les timeouts de connexion
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
